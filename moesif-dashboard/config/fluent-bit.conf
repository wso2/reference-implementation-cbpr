[SERVICE]
    flush        1
    daemon       Off
    log_level    info
    parsers_file /config/parsers.conf <path to parsers config>
    plugins_file /etc/fluent-bit/plugins.conf
    http_server  On
    http_listen  0.0.0.0
    http_port    2020
    storage.metrics on

[INPUT]
    Name             tail
    Tag              mtmx
    Path             /logs/dashboard*.log <path to dashboard logs>
    Parser           json
    Refresh_Interval 1
    exit_on_eof      off

[INPUT]
    Name             tail
    Tag              ballerina_logs
    Path             /logs/ballerina*.log <path to ballerina logs>
    Parser           ballerina_json_parser
    Refresh_Interval 1
    exit_on_eof      off

[FILTER]
    Name    lua
    Match   mtmx
    Script  /filter/dashboard-log-transform.lua <path to lua script>
    Call    moesif_transform

[FILTER]
    Name    lua
    Match   ballerina_logs
    Script  /filter/ballerina-log-transform.lua <path to lua script>
    Call    ballerina_transform

[OUTPUT]
    Name            http
    Match           mtmx
    Host            api.moesif.net
    Port            443
    URI             /v1/events/batch
    Format          json
    Header          X-Moesif-Application-Id <your moesif application id>
    Header          Content-Type application/json
    tls             On
    tls.verify      On
    json_date_format iso8601

[OUTPUT]
    Name            http
    Match           ballerina_logs
    Host            api.moesif.net
    Port            443
    URI             /v1/events/batch
    Format          json
    Header          X-Moesif-Application-Id <your moesif application id>
    Header          Content-Type application/json
    tls             On
    tls.verify      On
    json_date_format iso8601
